{% extends 'qa/template.html' %}

{% block content %}
	<style>
        .full-width{
            width: 100%;
        }
        .prepend-width{
            width: 100px;
        }
    </style>
	<div class='container-fluid ml-4 mt-3'>
		<div class='row ml-0'>
			<h5>Pergunta Selecionada</h5>
		</div>
		<div class='row'>
			<div class='col-11'>
				<div class="input-group mb-2 pl-0 col-4">
					<div class="input-group-prepend prepend-width">
						<div class="input-group-text full-width justify-content-center">
							Usuário
						</div>
					</div>
					<input type='text' name='username' class="form-control bg-light" value='{{pergunta.usuario}}' disabled/>
				</div>
				<div class="input-group mb-2">
					<div class="input-group-prepend prepend-width">
						<div class="input-group-text full-width justify-content-center">
							Titulo
						</div>
					</div>
					<input type='text' id="perguntaTitulo" class="form-control col-12 bg-light" name='titulo' value='{{pergunta.titulo}}'/>
				</div>
				<div class="input-group mb-2">
					<div class="input-group-prepend prepend-width">
						<div class="input-group-text full-width justify-content-center">
							Pergunta
						</div>
					</div>
					<textarea id="perguntaTexto" class="form-control col-12 bg-light" name='texto' rows='2'>{{pergunta.texto}}</textarea>
				</div>
				<div class="input-group">
                        <div class="input-group-prepend prepend-width">
                            <div class="input-group-text full-width justify-content-center">
                                Tags
                            </div>
                        </div>
                        <textarea id="perguntaTags" class="form-control col-12" rows="3" name="tags" placeholder="Digite as tags separadas por vírgulas." required>{{tags}}</textarea>
                    </div>
				{% if usuario != pergunta.usuario %}
				<script>
					$('#perguntaTitulo').attr('disabled', true);
					$('#perguntaTexto').attr('disabled', true);
					$('#perguntaTags').attr('disabled', true);
				</script>
				{% endif %}
				{% if usuario == pergunta.usuario %}
					<div class='row ml-0 mt-2 justify-content-center'>
						<form id='formAlterarPergunta' action='{% url "qa:alterar_pergunta" pergunta.id %}' method='post'>
							<input hidden id='texto_alterado' name='texto_alterado' required/>
							<input hidden id='titulo_alterado' name='titulo_alterado' required/>
							<input hidden id='tags_alterado' name='tags_alterado' required/>
							{% csrf_token %}
							<input type='button' id='alterarPerguntaBtn' class='btn btn-success py-1 mr-1' value='Alterar pergunta'/>
							<script>
								$("#alterarPerguntaBtn").click(function(){
									titulo_alterado = $('#perguntaTitulo').val()
									texto_alterado = $('#perguntaTexto').val()
									tags_alterado = $('#perguntaTags').val()
									$('#titulo_alterado').val(titulo_alterado)
									$('#texto_alterado').val(texto_alterado)
									$('#tags_alterado').val(tags_alterado)
									$("#formAlterarPergunta").submit();
								});
							</script>
						</form>
						<form action='{% url "qa:deletar_pergunta" pergunta.id %}' method='post'>
							{% csrf_token %}
							<input type='submit' class='btn btn-danger py-1 ml-1' value='Deletar pergunta'/>
						</form>
					</div>
				{% endif %}
			</div>
		</div>
		<hr class='mr-5'/>
		<div class='row ml-0'>
			<h5>Tags</h5>
		</div>
		<div class='col-11 pl-0 mb-1 pt-1' style='height:auto; max-height: 32vh; overflow:auto'>
		
			{% for tag in tagsList %}
				<a href="/tags/{{tag}}">{{tag}}</a>,
			{% endfor %}
		</div>
		<hr class='mr-5'/>
		<div class='row ml-0'>
			<h5>Respostas</h5>
		</div>
		{% if lista_respostas %}
		<div class='row ml-0'>
			<div class='col-11 pl-0 mb-1 pt-1' style='height:auto; max-height: 32vh; overflow:auto'>
				{% for resposta in lista_respostas %}
				<a class='nolink' href='/selecionar_resposta/{{resposta.id}}'>
					<div class='container mb-2' style='box-shadow: 0px 0px 1px 0.1px #aaaaaa; margin-left: 1px'>
						<div class='row'>
							<div class='col-6'>
								resposta #{{forloop.counter}}
							</div>
							<div class='col-6 text-right'>
								autor: {{resposta.usuario}}
							</div>
						</div>
						<div class='row border-top'>
							<div class='col-12'>
								<p>{{resposta.texto}}</p>
							</div>
						</div>
					</div>
				</a>
				{% endfor %}
			</div>
		</div>
        {% endif %}

		<hr class='mr-5'/>
		<div class='row ml-0'>
			<h5>Postar Resposta</h5>
		</div>
		<div class='row ml-0 mb-4'>
			<div class='col-11 px-0'>
				<form action='{% url "qa:postar_resposta" pergunta.id %}' method='post'>
					{% csrf_token %}
					<div class="form-group mb-0">
						<textarea id='respostaTexto' class="form-control col-12 bg-light" rows="5" name='texto' required></textarea>
					</div>
					<div class='row mt-2 mx-auto justify-content-end'>
						<input id='respostaSubmit' type='submit' value='Postar Resposta' class='btn bg-success px-5 text-light'/>
					</div>
					<script>
						function closeAlertBox(){
							alertBox = document.getElementById("alertBox");
							alertClose = document.getElementById("alertClose");
							alertBox.style.visibility = "hidden";
							alertClose.style.visibility = "hidden";
						}
						window.alert = function(msg){
							var id = "alertBox", alertBox, closeId = "alertClose", alertClose;
							alertBox = document.createElement("div");
							document.body.appendChild(alertBox);
							alertBox.id = id;
							alertBox.innerHTML = msg;
							alertClose = document.createElement("div");
							alertClose.id = closeId;
							alertClose.innerHTML = "x";
							alertBox.appendChild(alertClose);
							alertBox.style.visibility = "visible";
							alertClose.style.visibility = "visible";
							alertClose.onclick = closeAlertBox;
							alertBox.style.left = "1140px";
							if(sucesso == false)
							{
								document.getElementById('alertBox').style.backgroundColor = 'red'
							}
						};
						if ('{{usuario}}' === ''){
							flagUser = false
						}
						
						$('#respostaTexto').click(function(e){
							if(flagUser === false){
								$('#respostaTexto').attr('disabled', true)
								sucesso = false
								alert('Precisa Estar logado');
							}
						});

						$('#respostaSubmit').click(function(e){
							if(flagUser === false){
								e.preventDefault();
								sucesso=false;
								alert('Precisa Estar logado');
							}
						});
					</script>
				</form>
			</div>
		</div>
    </div>
{% endblock %}
